package com.redhat.cpaas.pipeline.model.component.build.artifact

import groovy.json.JsonSlurperClassic

class ContainerBuildArtifact extends BuildArtifact {
    /**
     * List of image names with registries that point to built image, redy to pull.
     */
    List<String> pull

    /**
     * List of main tags.
     */
    List<String> tags

    /**
     * List of all unique tags.
     * 
     * These are the long tags generated by OSBS.
     */
    List<String> uniqueTags

    /**
     * List of all floating tags applied to the image.
     */
    List<String> floatingTags

    /**
     * Unprocessed build info of the container image build in Brew.
     */
    String metadata

    ContainerBuildArtifact(String metadata) {
        this.metadata = metadata

        Map<String, Object> buildInfo = new JsonSlurperClassic().parseText(metadata)

        this.tags = buildInfo.extra.image.index.tags
        this.pull = buildInfo.extra.image.index.pull
        this.uniqueTags = buildInfo.extra.image.index.unique_tags
        this.floatingTags = buildInfo.extra.image.index.floating_tags
    }
}